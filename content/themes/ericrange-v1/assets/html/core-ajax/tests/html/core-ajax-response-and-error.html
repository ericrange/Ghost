<!doctype html><html><head><title>core-ajax-response-and-error</title><script src="../../../platform/platform.js"></script><script src="../../../polymer-test-tools/chai/chai.js"></script><script src="../../../polymer-test-tools/htmltest.js"></script><link rel="import" href="../../core-ajax.html"></head><body><polymer-element name="race-condition"><template><style>section{margin-top:20px}</style><core-ajax id="ajax" url="http://httpbin.org/delay/{{delay}}" handleas="json" auto response="{{response}}" on-core-response="{{handleResponse}}"></core-ajax><div>Response url: {{response.url}}</div><div>Result: {{testResult}}</div><section><div>Requests</div><ul><template repeat="{{request in requests}}"><li>{{request.delay}} second delay, Status: {{request.statusText}}</li></template></ul></section></template><script>Polymer({delay:1,response:null,testResult:"pending...",passed:!1,requests:[],observe:{"$.ajax.activeRequest":"requestChanged"},domReady:function(){setTimeout(function(){return null!=this.response?(console.error("HTTP request returned too quick!"),chai.assert.fail("","","Indeterminate, initial request returned too quick"),void(this.testResult="indeterminate")):void(this.delay=2)}.bind(this),100),this.finalTimeout=setTimeout(function(){chai.assert.fail("","","Test timed out.")},7e3)},responseChanged:function(){return this.response.url!=this.$.ajax.url?(this.testResult="FAIL",void chai.assert.fail(this.$.ajax.url,this.response.url,"Race condition in response attribute")):void(this.passed=!0)},passedChanged:function(){this.passed&&"pending..."==this.testResult&&(this.testResult="PASS",clearTimeout(this.finalTimeout),done())},requestChanged:function(e,t){this.requests.push({statusText:"pending",xhr:t,delay:this.delay})},handleResponse:function(e){for(var t=e.detail.xhr,s=0;s<this.requests.length;s++)this.requests[s].xhr===t&&(this.requests[s].statusText=t.statusText)}});</script></polymer-element><race-condition></race-condition></body></html>