<link href="../core-selector/core-selector.html" rel="import"><link href="transitions/hero-transition.html" rel="import"><link href="transitions/cross-fade.html" rel="import"><polymer-element name="core-animated-pages" extends="core-selector" notap attributes="transitions"><template><link href="core-animated-pages.css" rel="stylesheet"><shadow></shadow></template><script>Polymer({eventDelegates:{"core-transitionend":"transitionEnd"},transitions:"",selected:0,lastSelected:null,registerCallback:function(){this.tmeta=document.createElement("core-transition")},created:function(){this._transitions=[],this.transitioning=[]},transitionsChanged:function(){this._transitions=this.transitions.split(" ")},_transitionsChanged:function(){this._transitionElements&&this._transitionElements.forEach(function(t){t.teardown(this)},this),this._transitionElements=[],this._transitions.forEach(function(t){var i=this.getTransition(t);i&&(this._transitionElements.push(i),i.setup(this))},this)},getTransition:function(t){return this.tmeta.byId(t)},selectionSelect:function(){this.updateSelectedItem()},applyTransition:function(t,i){this.animating&&(this.cancelAsync(this.animating),this.animating=null),Platform.flush(),-1===this.transitioning.indexOf(t)&&this.transitioning.push(t),-1===this.transitioning.indexOf(i)&&this.transitioning.push(i),t.setAttribute("animate",""),i.setAttribute("animate","");var n={src:t,dst:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)"};this.fire("core-animated-pages-transition-prepare"),this._transitionElements.forEach(function(t){t.prepare(this,n)},this),t.offsetTop,this.applySelection(i,!0),this.applySelection(t,!1),this._transitionElements.forEach(function(t){t.go(this,n)},this),this._transitionElements.length?this.animating=this.async(this.complete.bind(this),null,5e3):this.complete()},complete:function(){this.animating&&(this.cancelAsync(this.animating),this.animating=null),this.transitioning.forEach(function(t){t.removeAttribute("animate")}),this.transitioning=[],this._transitionElements.forEach(function(t){t.ensureComplete(this)},this),this.fire("core-animated-pages-transition-end")},transitionEnd:function(){if(this.transitioning.length){var t=!0;this._transitionElements.forEach(function(i){i.completed||(t=!1)}),t&&this.job("transitionWatch",function(){this.complete()},100)}},selectedChanged:function(t){this.lastSelected=t,this.super(arguments)},selectedItemChanged:function(t){if(this.super(arguments),!t)return void this.applySelection(this.selectedItem,!0);if(this.hasAttribute("no-transition")||!this._transitionElements||!this._transitionElements.length)return this.applySelection(t,!1),void this.applySelection(this.selectedItem,!0);if(t&&this.selectedItem){var i=this;Platform.flush(),Platform.endOfMicrotask(function(){i.applyTransition(t,i.selectedItem)})}}});</script></polymer-element>